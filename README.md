# MCS

[TOC]

### Method

单次MC：随机行走获得系综的**平衡态**概率分布，并用该分布求出相关量。

但外电/磁场变化的情况下，通常不能被看作平衡态。应当考虑**准静态**近似：即需要假设极化/磁矩改变花费的时间（一般$\mu s$级==？==）小于时间步长，或者说**外场不能变化太快**。

在[PHYSICAL REVIEW MATERIALS **3**, 044410 (2019)](D:\Documents\Articles\MontC\PhysRevMaterials.3.044410.pdf)中所用到的[方法](D:\Documents\Articles\MontC\2019-03-20-Si_001_SI-PRM.pdf)是：令蒙卡步绑定时间，在一定的步数后（为了扫场周期尽量一致，这个值随温度改变），改变外加场。【PS:这篇文章蒙卡（Ising）采样量似乎有点少。$100\times 100$ 网格，相变点计算每个温度只有$2000$蒙卡步取后$500$采样，而回线上单点只有$20/80/200$个采样点（也有可能做了多个loop但是没提）。按照过往$32\times 32$网格的经验来说，$2000$步可能甚至还没收敛。扩大网格能够加速收敛，$100\times 100$的收敛状况具体得试验一下。】

这样有几个比较重要的问题：

* 如果外场只扫一个循环，那么在某个特定外场的样本有限。因为将蒙卡步与时间绑定之后，在确定的温度和确定的外场改变速度下，每个外场采样点的样本数量也就固定了。
* 当外场改变之后，从上一段时间继承下来的信息只有一个固定的态而非整个系综的分布。再综合上一点，会让收敛变得更加困难。

对于蒙卡来说，一个很方便解决问题的方法就是加大模拟次数。对于电/磁滞回线来说，由于扫场是周期的，可以看作增加模拟时间。

我个人觉得，可能采取如下方式会比较好：

* 不再用时间来限制模拟步数，而是用模拟步数决定时间和外场。外场采样的时间间隔给模拟步数做出了限制。对于Ising来说还能够根据翻转所需时间计算步数限制，但对于Heisenberg模型来说，旋转的是一个随机角度，就没那么方便确定了（或许可以用最大耗时来近似代替？）。那不如让一定离散的模拟步数来做自变量。即：**在每一步模拟之后，根据系统前后的改变量来计算耗时，进而计算下一步模拟时的外场**。**MC之所以要连续模拟很多步并且抛弃开头的数据，是为了收敛到平衡态。如今模拟的体系都不是平衡态，自然没有必要也不能固定外场再模拟数步来尝试收敛。**在这点假设之下，有两个东西变得十分重要：一是**模拟开始前初态的选择**，二是**时间步长的计算函数**。
* 对于初态的选择或许可以这样：首先在$0$时刻的固定外场下做蒙卡，使得体系达到平衡。平衡之后，在平衡的段上取若干状态作为初态，各自进行模拟。
* ==【并不确定】==在每一步模拟的时候，可以在多个点位进行改变，之后再按概率选择演化方向。（如果所选点位互不干扰或许可以一同演化？）这样可以加速最终结果的收敛，减少所需初态的数量。
* ==【并不确定】==耗时函数并非局域翻转需要时间，而是某种平均，因为翻转（不翻转也算）并不是完全按照时间顺序一个接一个首尾相连地发生。（以下纯口糊）或许耗时函数可以这样确定：首先达到平衡态，之后让外场改变一个小量，计算再次到达平衡态所需的平均模拟步，再跟实验或者包含时间的模拟得到的弛豫时间对比（或者vasp里离子步之类的东西？）。用这二者构造函数作为耗时函数。如果模拟步数足够多，那么就可以用这二者的平均做一个常函数。或者干脆摆烂，跟文献一样直接按局域翻转的耗时数据作为时间函数，只和温度有关。



### Formula

$$
H_{spin}(\{S\})=\sum_iS_i^TA_iS_i+\sum_{i,j,i<j}S_i^TB_{i,j}S_j
$$

$$
H_{spin}(\{S\};B)=H_{spin}(\{S\})-g\mu_B\sum_{i}S_i\cdot B
$$

$g$ 为朗格$g$ 因子。
